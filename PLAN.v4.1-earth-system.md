# Plan v4.1 - Earth System Realism (Wind, Currents, Solar)

## 文档定位
- 本文档是 **v4.1 修正版计划**，替代 v4.0 中“地理信息图层优先”的方向。
- 目标改为：**洋流 + 风场 + 太阳驱动 + 云系/海面响应** 的拟真地球。
- 分区关系：
  - `PLAN.md`：v1.0 功能建设
  - `PLAN.v2-debug.md`：v2.0 稳定性修复
  - `PLAN.v3-atmosphere.md`：v3.0 大气光晕优化
  - `PLAN.v4-geo-realism.md`：v4.0（已被 v4.1 修正）
  - `PLAN.v4.1-earth-system.md`：v4.1 地球系统拟真（当前有效）

## 1. v4.1 核心目标
1. 太阳光照拟真
- 按真实时间计算太阳方向（含地轴倾角与季节变化）。
- 昼夜边界与黄昏带动态变化，驱动地表与大气表现。

2. 风场可视化（Global Wind Field）
- 展示全球主要风带：信风、西风带、极地东风、急流区。
- 使用流线/粒子沿球面矢量场运动，支持不同高度层简化表达。

3. 洋流可视化（Ocean Current Field）
- 展示主要环流与边界流（如湾流、黑潮、南极绕极流等）。
- 用速度与方向驱动海面流动纹理或粒子轨迹。

4. 耦合拟真效果
- 云层受风场影响（方向与速度联动）。
- 海面高光、粗糙度随风速变化（风强海面更“碎光”）。
- 夜景亮度在云层覆盖区域有弱抑制（可选）。

## 1.1 可追加的拟真模拟（你刚提的扩展）
1. 海浪与浪向（Wave Field）
- 叠加显著波高与主浪向，和风场耦合。

2. 海表温度（SST）与海温异常
- 显示冷暖水团、暖流与寒流边界。

3. 气压场（Pressure）与等压线
- 可视化高低压系统，和风向形成闭环解释。

4. 降水/湿度云带（Precipitable Water / Rain Belt）
- 展示ITCZ、季风雨带等大尺度结构。

5. 海盐度与密度（Salinity / Density）
- 用于解释热盐环流（Thermohaline Circulation）。

6. 海平面高度异常（SSH Anomaly）
- 展示海盆尺度起伏与涡旋活动。

7. 风暴与台风路径回放（Tracks）
- 叠加历史路径，支持时间轴回放。

8. 气候模态指数（ENSO/NAO 简化）
- 用于驱动年度尺度背景态变化。

## 2. 明确不做（本阶段）
- 不以“国界、城市标签、行政区信息”作为主目标。
- 不做重 GIS 标注系统（避免信息喧宾夺主）。

## 3. 数据与模型方案
## 3.1 风场数据
- 数据类型：全球纬经网格矢量场（u/v 分量）。
- 可选来源：ERA5 / GFS / 可公开风场样例集。
- 策略：先离线预处理为轻量纹理或分块二进制，再前端插值采样。

## 3.2 洋流数据
- 数据类型：全球海流矢量场（表层流速与方向）。
- 可选来源：OSCAR / Copernicus Marine / NOAA 公开产品。
- 策略：先做月平均或季节平均版本，再扩展到时间序列。

## 3.3 时间驱动
- 输入：UTC 时间 + 时间倍率。
- 输出：太阳方向、风场帧、洋流帧、云层推进系数。

## 4. 渲染与工程架构
### Phase A - Solar Pipeline
- 构建太阳方向计算模块。
- 统一给地表/夜景/大气 shader 同步 sun uniforms。
- 验收：时间变化可见且逻辑一致。

### Phase B - Wind Layer
- 构建球面风场采样器（双线性插值）。
- 实现风粒子/流线层（颜色=速度，方向=矢量）。
- 验收：可见全球风带结构，缩放后轨迹连续。

### Phase C - Ocean Current Layer
- 构建洋流采样器与粒子层。
- 与海面材质联动（高光破碎度/法线扰动强度）。
- 验收：主要环流方向正确，速度梯度明显。

### Phase D - Coupled Effects
- 云层移动由风场驱动，不再固定匀速。
- 海洋区域对风场做视觉响应（白沫/反光变化可选简化）。
- 验收：视觉上能感知“风驱海洋、太阳驱昼夜”的关系。

### Phase E - Performance & LOD
- 粒子数按设备分档（desktop/mobile）。
- 远景低密度，近景高密度。
- 加入帧预算与自动降级。

## 5. 交互设计
- 图层开关：`Solar` / `Wind` / `Current` / `Cloud coupling`。
- 时间控制：`Real-time`、`x10`、`x60`、`Pause`。
- 视觉预设：`Cinematic`（低信息）/ `Science`（高信息）。

## 6. 验收标准
- P0：风向与洋流方向明显可辨且连续。
- P0：不再出现长时间 loading 或空白场景。
- P0：本地与 GitHub Pages 都可稳定展示。
- P1：移动端可运行，帧率不低于可接受阈值（>=30fps 目标）。
- P1：时间推进时，太阳、风、洋流有一致动态逻辑。

## 7. 风险与应对
1. 数据体积大
- 应对：离线压缩、分辨率分档、按需加载。

2. 粒子层开销高
- 应对：GPU 粒子优先，移动端降采样。

3. 数据授权限制
- 应对：仅使用允许再分发的数据，并在仓库记录 license。

4. 视觉过载
- 应对：默认简洁模式，图层由用户按需开启。

## 8. 实施顺序（建议）
1. 太阳光照统一管线（先稳定）。
2. 风场层。
3. 洋流层。
4. 云层/海面耦合。
5. 海浪浪向 + 海表温度（SST）。
6. 气压与降水带（可开关）。
7. 性能分档与线上回归。

## 8.1 分期建议（避免一次性过重）
- v4.1（第一阶段，强推荐）：
  - Solar + Wind + Current + Cloud/Ocean coupling
- v4.2（第二阶段）：
  - Wave + SST + Pressure
- v4.3（第三阶段）：
  - Rain/Humidity + Salinity/Density + SSH + Storm tracks

## 9. 本轮边界
- 本次仅输出 v4.1 计划文档，不改代码。
- 下一轮从 `Phase A` 开始实现。
